{"ast":null,"code":"import { defineComponent, ref, computed, watch, onMounted, nextTick, onBeforeUnmount, resolveComponent, openBlock, createBlock, renderSlot, createVNode, toDisplayString, mergeProps, Teleport, Fragment, createCommentVNode } from 'vue';\nimport throttle from 'lodash/throttle';\nimport { useLocaleInject, useAttrs } from '../hooks';\nimport isServer from '../utils/isServer';\nimport { getScrollContainer, on, off, isInContainer } from '../utils/dom';\nimport ImageViewer from '../el-image-viewer';\n/**\n * Make a map and return a function for checking if a key\n * is in that map.\n * IMPORTANT: all calls of this function must be prefixed with\n * \\/\\*#\\_\\_PURE\\_\\_\\*\\/\n * So that rollup can tree-shake them if necessary.\n */\n\nconst EMPTY_OBJ = process.env.NODE_ENV !== 'production' ? Object.freeze({}) : {};\nconst EMPTY_ARR = process.env.NODE_ENV !== 'production' ? Object.freeze([]) : [];\n\nconst isString = val => typeof val === 'string';\n\nconst isSupportObjectFit = () => document.documentElement.style.objectFit !== void 0;\n\nconst isHtmlEle = e => e && e.nodeType === 1;\n\nconst ObjectFit = {\n  NONE: \"none\",\n  CONTAIN: \"contain\",\n  COVER: \"cover\",\n  FILL: \"fill\",\n  SCALE_DOWN: \"scale-down\"\n};\nlet prevOverflow = \"\";\nvar script = defineComponent({\n  name: \"ElImage\",\n  components: {\n    ImageViewer\n  },\n  inheritAttrs: false,\n  props: {\n    appendToBody: {\n      type: Boolean,\n      default: false\n    },\n    hideOnClickModal: {\n      type: Boolean,\n      default: false\n    },\n    src: {\n      type: String,\n      default: \"\"\n    },\n    fit: {\n      type: String,\n      default: \"\"\n    },\n    lazy: {\n      type: Boolean,\n      default: false\n    },\n    scrollContainer: {\n      type: [String, Object],\n      default: null\n    },\n    previewSrcList: {\n      type: Array,\n      default: () => []\n    },\n    zIndex: {\n      type: Number,\n      default: 2e3\n    }\n  },\n  emits: [\"error\"],\n\n  setup(props, {\n    emit\n  }) {\n    const {\n      t\n    } = useLocaleInject();\n    const attrs = useAttrs();\n    const hasLoadError = ref(false);\n    const loading = ref(true);\n    const imgWidth = ref(0);\n    const imgHeight = ref(0);\n    const showViewer = ref(false);\n    const container = ref(null);\n    let _scrollContainer = null;\n    let _lazyLoadHandler = null;\n    const imageStyle = computed(() => {\n      const {\n        fit\n      } = props;\n\n      if (!isServer && fit) {\n        return isSupportObjectFit() ? {\n          \"object-fit\": fit\n        } : getImageStyle(fit);\n      }\n\n      return {};\n    });\n    const alignCenter = computed(() => {\n      const {\n        fit\n      } = props;\n      return !isServer && !isSupportObjectFit() && fit !== ObjectFit.FILL;\n    });\n    const preview = computed(() => {\n      const {\n        previewSrcList\n      } = props;\n      return Array.isArray(previewSrcList) && previewSrcList.length > 0;\n    });\n    const imageIndex = computed(() => {\n      const {\n        src,\n        previewSrcList\n      } = props;\n      let previewIndex = 0;\n      const srcIndex = previewSrcList.indexOf(src);\n\n      if (srcIndex >= 0) {\n        previewIndex = srcIndex;\n      }\n\n      return previewIndex;\n    });\n\n    function getImageStyle(fit) {\n      const imageWidth = imgWidth.value;\n      const imageHeight = imgHeight.value;\n      if (!container.value) return {};\n      const {\n        clientWidth: containerWidth,\n        clientHeight: containerHeight\n      } = container.value;\n      if (!imageWidth || !imageHeight || !containerWidth || !containerHeight) return {};\n      const imageAspectRatio = imageWidth / imageHeight;\n      const containerAspectRatio = containerWidth / containerHeight;\n\n      if (fit === ObjectFit.SCALE_DOWN) {\n        const isSmaller = imageWidth < containerWidth && imageHeight < containerHeight;\n        fit = isSmaller ? ObjectFit.NONE : ObjectFit.CONTAIN;\n      }\n\n      switch (fit) {\n        case ObjectFit.NONE:\n          return {\n            width: \"auto\",\n            height: \"auto\"\n          };\n\n        case ObjectFit.CONTAIN:\n          return imageAspectRatio < containerAspectRatio ? {\n            width: \"auto\"\n          } : {\n            height: \"auto\"\n          };\n\n        case ObjectFit.COVER:\n          return imageAspectRatio < containerAspectRatio ? {\n            height: \"auto\"\n          } : {\n            width: \"auto\"\n          };\n\n        default:\n          return {};\n      }\n    }\n\n    const loadImage = () => {\n      if (isServer) return;\n      const attributes = attrs.value;\n      loading.value = true;\n      hasLoadError.value = false;\n      const img = new Image();\n\n      img.onload = e => handleLoad(e, img);\n\n      img.onerror = handleError;\n      Object.keys(attributes).forEach(key => {\n        if (key.toLowerCase() === \"onload\") return;\n        const value = attributes[key];\n        img.setAttribute(key, value);\n      });\n      img.src = props.src;\n    };\n\n    function handleLoad(e, img) {\n      imgWidth.value = img.width;\n      imgHeight.value = img.height;\n      loading.value = false;\n      hasLoadError.value = false;\n    }\n\n    function handleError(e) {\n      loading.value = false;\n      hasLoadError.value = true;\n      emit(\"error\", e);\n    }\n\n    function handleLazyLoad() {\n      if (isInContainer(container.value, _scrollContainer)) {\n        loadImage();\n        removeLazyLoadListener();\n      }\n    }\n\n    function addLazyLoadListener() {\n      if (isServer) return;\n      const {\n        scrollContainer\n      } = props;\n\n      if (isHtmlEle(scrollContainer)) {\n        _scrollContainer = scrollContainer;\n      } else if (isString(scrollContainer) && scrollContainer !== \"\") {\n        _scrollContainer = document.querySelector(scrollContainer);\n      } else {\n        _scrollContainer = getScrollContainer(container.value);\n      }\n\n      if (_scrollContainer) {\n        _lazyLoadHandler = throttle(handleLazyLoad, 200);\n        on(_scrollContainer, \"scroll\", _lazyLoadHandler);\n        setTimeout(() => handleLazyLoad(), 100);\n      }\n    }\n\n    function removeLazyLoadListener() {\n      if (isServer || !_scrollContainer || !_lazyLoadHandler) return;\n      off(_scrollContainer, \"scroll\", _lazyLoadHandler);\n      _scrollContainer = null;\n      _lazyLoadHandler = null;\n    }\n\n    function clickHandler() {\n      if (!preview.value) {\n        return;\n      }\n\n      prevOverflow = document.body.style.overflow;\n      document.body.style.overflow = \"hidden\";\n      showViewer.value = true;\n    }\n\n    function closeViewer() {\n      document.body.style.overflow = prevOverflow;\n      showViewer.value = false;\n    }\n\n    watch(() => props.src, () => {\n      loadImage();\n    });\n    onMounted(() => {\n      if (props.lazy) {\n        nextTick(addLazyLoadListener);\n      } else {\n        loadImage();\n      }\n    });\n    onBeforeUnmount(() => {\n      props.lazy && removeLazyLoadListener();\n    });\n    return {\n      attrs,\n      loading,\n      hasLoadError,\n      showViewer,\n      imgWidth,\n      imgHeight,\n      imageStyle,\n      alignCenter,\n      preview,\n      imageIndex,\n      clickHandler,\n      closeViewer,\n      container,\n      handleError,\n      t\n    };\n  }\n\n});\n\nconst _hoisted_1 = /* @__PURE__ */createVNode(\"div\", {\n  class: \"el-image__placeholder\"\n}, null, -1);\n\nconst _hoisted_2 = {\n  class: \"el-image__error\"\n};\n\nfunction render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_image_viewer = resolveComponent(\"image-viewer\");\n\n  return openBlock(), createBlock(\"div\", {\n    ref: \"container\",\n    class: [\"el-image\", _ctx.$attrs.class],\n    style: _ctx.$attrs.style\n  }, [_ctx.loading ? renderSlot(_ctx.$slots, \"placeholder\", {\n    key: 0\n  }, () => [_hoisted_1]) : _ctx.hasLoadError ? renderSlot(_ctx.$slots, \"error\", {\n    key: 1\n  }, () => [createVNode(\"div\", _hoisted_2, toDisplayString(_ctx.t(\"el.image.error\")), 1)]) : (openBlock(), createBlock(\"img\", mergeProps({\n    key: 2,\n    class: \"el-image__inner\"\n  }, _ctx.attrs, {\n    src: _ctx.src,\n    style: _ctx.imageStyle,\n    class: {\n      \"el-image__inner--center\": _ctx.alignCenter,\n      \"el-image__preview\": _ctx.preview\n    },\n    onClick: _cache[1] || (_cache[1] = (...args) => _ctx.clickHandler && _ctx.clickHandler(...args))\n  }), null, 16, [\"src\"])), (openBlock(), createBlock(Teleport, {\n    to: \"body\",\n    disabled: !_ctx.appendToBody\n  }, [_ctx.preview ? (openBlock(), createBlock(Fragment, {\n    key: 0\n  }, [_ctx.showViewer ? (openBlock(), createBlock(_component_image_viewer, {\n    key: 0,\n    \"z-index\": _ctx.zIndex,\n    \"initial-index\": _ctx.imageIndex,\n    \"url-list\": _ctx.previewSrcList,\n    \"hide-on-click-modal\": _ctx.hideOnClickModal,\n    onClose: _ctx.closeViewer\n  }, null, 8, [\"z-index\", \"initial-index\", \"url-list\", \"hide-on-click-modal\", \"onClose\"])) : createCommentVNode(\"v-if\", true)], 2112)) : createCommentVNode(\"v-if\", true)], 8, [\"disabled\"]))], 6);\n}\n\nscript.render = render;\nscript.__file = \"packages/image/src/index.vue\";\n\nscript.install = app => {\n  app.component(script.name, script);\n};\n\nconst _Image = script;\nexport default _Image;","map":{"version":3,"sources":["D:/A-大三下/web开发/xducat/xducat-client/node_modules/element-plus/es/el-image/index.js"],"names":["defineComponent","ref","computed","watch","onMounted","nextTick","onBeforeUnmount","resolveComponent","openBlock","createBlock","renderSlot","createVNode","toDisplayString","mergeProps","Teleport","Fragment","createCommentVNode","throttle","useLocaleInject","useAttrs","isServer","getScrollContainer","on","off","isInContainer","ImageViewer","EMPTY_OBJ","process","env","NODE_ENV","Object","freeze","EMPTY_ARR","isString","val","isSupportObjectFit","document","documentElement","style","objectFit","isHtmlEle","e","nodeType","ObjectFit","NONE","CONTAIN","COVER","FILL","SCALE_DOWN","prevOverflow","script","name","components","inheritAttrs","props","appendToBody","type","Boolean","default","hideOnClickModal","src","String","fit","lazy","scrollContainer","previewSrcList","Array","zIndex","Number","emits","setup","emit","t","attrs","hasLoadError","loading","imgWidth","imgHeight","showViewer","container","_scrollContainer","_lazyLoadHandler","imageStyle","getImageStyle","alignCenter","preview","isArray","length","imageIndex","previewIndex","srcIndex","indexOf","imageWidth","value","imageHeight","clientWidth","containerWidth","clientHeight","containerHeight","imageAspectRatio","containerAspectRatio","isSmaller","width","height","loadImage","attributes","img","Image","onload","handleLoad","onerror","handleError","keys","forEach","key","toLowerCase","setAttribute","handleLazyLoad","removeLazyLoadListener","addLazyLoadListener","querySelector","setTimeout","clickHandler","body","overflow","closeViewer","_hoisted_1","class","_hoisted_2","render","_ctx","_cache","$props","$setup","$data","$options","_component_image_viewer","$attrs","$slots","onClick","args","to","disabled","onClose","__file","install","app","component","_Image"],"mappings":"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","sourcesContent":["import { defineComponent, ref, computed, watch, onMounted, nextTick, onBeforeUnmount, resolveComponent, openBlock, createBlock, renderSlot, createVNode, toDisplayString, mergeProps, Teleport, Fragment, createCommentVNode } from 'vue';\nimport throttle from 'lodash/throttle';\nimport { useLocaleInject, useAttrs } from '../hooks';\nimport isServer from '../utils/isServer';\nimport { getScrollContainer, on, off, isInContainer } from '../utils/dom';\nimport ImageViewer from '../el-image-viewer';\n\n/**\n * Make a map and return a function for checking if a key\n * is in that map.\n * IMPORTANT: all calls of this function must be prefixed with\n * \\/\\*#\\_\\_PURE\\_\\_\\*\\/\n * So that rollup can tree-shake them if necessary.\n */\nconst EMPTY_OBJ = (process.env.NODE_ENV !== 'production')\n    ? Object.freeze({})\n    : {};\nconst EMPTY_ARR = (process.env.NODE_ENV !== 'production') ? Object.freeze([]) : [];\nconst isString = (val) => typeof val === 'string';\n\nconst isSupportObjectFit = () => document.documentElement.style.objectFit !== void 0;\nconst isHtmlEle = (e) => e && e.nodeType === 1;\nconst ObjectFit = {\n  NONE: \"none\",\n  CONTAIN: \"contain\",\n  COVER: \"cover\",\n  FILL: \"fill\",\n  SCALE_DOWN: \"scale-down\"\n};\nlet prevOverflow = \"\";\nvar script = defineComponent({\n  name: \"ElImage\",\n  components: {\n    ImageViewer\n  },\n  inheritAttrs: false,\n  props: {\n    appendToBody: {\n      type: Boolean,\n      default: false\n    },\n    hideOnClickModal: {\n      type: Boolean,\n      default: false\n    },\n    src: {\n      type: String,\n      default: \"\"\n    },\n    fit: {\n      type: String,\n      default: \"\"\n    },\n    lazy: {\n      type: Boolean,\n      default: false\n    },\n    scrollContainer: {\n      type: [String, Object],\n      default: null\n    },\n    previewSrcList: {\n      type: Array,\n      default: () => []\n    },\n    zIndex: {\n      type: Number,\n      default: 2e3\n    }\n  },\n  emits: [\"error\"],\n  setup(props, { emit }) {\n    const { t } = useLocaleInject();\n    const attrs = useAttrs();\n    const hasLoadError = ref(false);\n    const loading = ref(true);\n    const imgWidth = ref(0);\n    const imgHeight = ref(0);\n    const showViewer = ref(false);\n    const container = ref(null);\n    let _scrollContainer = null;\n    let _lazyLoadHandler = null;\n    const imageStyle = computed(() => {\n      const { fit } = props;\n      if (!isServer && fit) {\n        return isSupportObjectFit() ? { \"object-fit\": fit } : getImageStyle(fit);\n      }\n      return {};\n    });\n    const alignCenter = computed(() => {\n      const { fit } = props;\n      return !isServer && !isSupportObjectFit() && fit !== ObjectFit.FILL;\n    });\n    const preview = computed(() => {\n      const { previewSrcList } = props;\n      return Array.isArray(previewSrcList) && previewSrcList.length > 0;\n    });\n    const imageIndex = computed(() => {\n      const { src, previewSrcList } = props;\n      let previewIndex = 0;\n      const srcIndex = previewSrcList.indexOf(src);\n      if (srcIndex >= 0) {\n        previewIndex = srcIndex;\n      }\n      return previewIndex;\n    });\n    function getImageStyle(fit) {\n      const imageWidth = imgWidth.value;\n      const imageHeight = imgHeight.value;\n      if (!container.value)\n        return {};\n      const {\n        clientWidth: containerWidth,\n        clientHeight: containerHeight\n      } = container.value;\n      if (!imageWidth || !imageHeight || !containerWidth || !containerHeight)\n        return {};\n      const imageAspectRatio = imageWidth / imageHeight;\n      const containerAspectRatio = containerWidth / containerHeight;\n      if (fit === ObjectFit.SCALE_DOWN) {\n        const isSmaller = imageWidth < containerWidth && imageHeight < containerHeight;\n        fit = isSmaller ? ObjectFit.NONE : ObjectFit.CONTAIN;\n      }\n      switch (fit) {\n        case ObjectFit.NONE:\n          return { width: \"auto\", height: \"auto\" };\n        case ObjectFit.CONTAIN:\n          return imageAspectRatio < containerAspectRatio ? { width: \"auto\" } : { height: \"auto\" };\n        case ObjectFit.COVER:\n          return imageAspectRatio < containerAspectRatio ? { height: \"auto\" } : { width: \"auto\" };\n        default:\n          return {};\n      }\n    }\n    const loadImage = () => {\n      if (isServer)\n        return;\n      const attributes = attrs.value;\n      loading.value = true;\n      hasLoadError.value = false;\n      const img = new Image();\n      img.onload = (e) => handleLoad(e, img);\n      img.onerror = handleError;\n      Object.keys(attributes).forEach((key) => {\n        if (key.toLowerCase() === \"onload\")\n          return;\n        const value = attributes[key];\n        img.setAttribute(key, value);\n      });\n      img.src = props.src;\n    };\n    function handleLoad(e, img) {\n      imgWidth.value = img.width;\n      imgHeight.value = img.height;\n      loading.value = false;\n      hasLoadError.value = false;\n    }\n    function handleError(e) {\n      loading.value = false;\n      hasLoadError.value = true;\n      emit(\"error\", e);\n    }\n    function handleLazyLoad() {\n      if (isInContainer(container.value, _scrollContainer)) {\n        loadImage();\n        removeLazyLoadListener();\n      }\n    }\n    function addLazyLoadListener() {\n      if (isServer)\n        return;\n      const { scrollContainer } = props;\n      if (isHtmlEle(scrollContainer)) {\n        _scrollContainer = scrollContainer;\n      } else if (isString(scrollContainer) && scrollContainer !== \"\") {\n        _scrollContainer = document.querySelector(scrollContainer);\n      } else {\n        _scrollContainer = getScrollContainer(container.value);\n      }\n      if (_scrollContainer) {\n        _lazyLoadHandler = throttle(handleLazyLoad, 200);\n        on(_scrollContainer, \"scroll\", _lazyLoadHandler);\n        setTimeout(() => handleLazyLoad(), 100);\n      }\n    }\n    function removeLazyLoadListener() {\n      if (isServer || !_scrollContainer || !_lazyLoadHandler)\n        return;\n      off(_scrollContainer, \"scroll\", _lazyLoadHandler);\n      _scrollContainer = null;\n      _lazyLoadHandler = null;\n    }\n    function clickHandler() {\n      if (!preview.value) {\n        return;\n      }\n      prevOverflow = document.body.style.overflow;\n      document.body.style.overflow = \"hidden\";\n      showViewer.value = true;\n    }\n    function closeViewer() {\n      document.body.style.overflow = prevOverflow;\n      showViewer.value = false;\n    }\n    watch(() => props.src, () => {\n      loadImage();\n    });\n    onMounted(() => {\n      if (props.lazy) {\n        nextTick(addLazyLoadListener);\n      } else {\n        loadImage();\n      }\n    });\n    onBeforeUnmount(() => {\n      props.lazy && removeLazyLoadListener();\n    });\n    return {\n      attrs,\n      loading,\n      hasLoadError,\n      showViewer,\n      imgWidth,\n      imgHeight,\n      imageStyle,\n      alignCenter,\n      preview,\n      imageIndex,\n      clickHandler,\n      closeViewer,\n      container,\n      handleError,\n      t\n    };\n  }\n});\n\nconst _hoisted_1 = /* @__PURE__ */ createVNode(\"div\", { class: \"el-image__placeholder\" }, null, -1);\nconst _hoisted_2 = { class: \"el-image__error\" };\nfunction render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_image_viewer = resolveComponent(\"image-viewer\");\n  return openBlock(), createBlock(\"div\", {\n    ref: \"container\",\n    class: [\"el-image\", _ctx.$attrs.class],\n    style: _ctx.$attrs.style\n  }, [\n    _ctx.loading ? renderSlot(_ctx.$slots, \"placeholder\", { key: 0 }, () => [\n      _hoisted_1\n    ]) : _ctx.hasLoadError ? renderSlot(_ctx.$slots, \"error\", { key: 1 }, () => [\n      createVNode(\"div\", _hoisted_2, toDisplayString(_ctx.t(\"el.image.error\")), 1)\n    ]) : (openBlock(), createBlock(\"img\", mergeProps({\n      key: 2,\n      class: \"el-image__inner\"\n    }, _ctx.attrs, {\n      src: _ctx.src,\n      style: _ctx.imageStyle,\n      class: { \"el-image__inner--center\": _ctx.alignCenter, \"el-image__preview\": _ctx.preview },\n      onClick: _cache[1] || (_cache[1] = (...args) => _ctx.clickHandler && _ctx.clickHandler(...args))\n    }), null, 16, [\"src\"])),\n    (openBlock(), createBlock(Teleport, {\n      to: \"body\",\n      disabled: !_ctx.appendToBody\n    }, [\n      _ctx.preview ? (openBlock(), createBlock(Fragment, { key: 0 }, [\n        _ctx.showViewer ? (openBlock(), createBlock(_component_image_viewer, {\n          key: 0,\n          \"z-index\": _ctx.zIndex,\n          \"initial-index\": _ctx.imageIndex,\n          \"url-list\": _ctx.previewSrcList,\n          \"hide-on-click-modal\": _ctx.hideOnClickModal,\n          onClose: _ctx.closeViewer\n        }, null, 8, [\"z-index\", \"initial-index\", \"url-list\", \"hide-on-click-modal\", \"onClose\"])) : createCommentVNode(\"v-if\", true)\n      ], 2112)) : createCommentVNode(\"v-if\", true)\n    ], 8, [\"disabled\"]))\n  ], 6);\n}\n\nscript.render = render;\nscript.__file = \"packages/image/src/index.vue\";\n\nscript.install = (app) => {\n  app.component(script.name, script);\n};\nconst _Image = script;\n\nexport default _Image;\n"]},"metadata":{},"sourceType":"module"}